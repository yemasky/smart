<div class="aside box-shadow h-10x col-sm-11 b-r box-shadow no-padding" tabindex="-1" role="dialog">
  <div class="aside-dialog">
    <div class="aside-content">
      <div class="aside-header" ng-show="title">
        <button type="button" class="close" ng-click="$hide()">&times;</button>
        <h4 class="aside-title" ng-bind-html="title"></h4>
      </div>
      <form name="RoomBookEditForm" class="form-validation" id="thisForm" ng-submit="">
      <div class="aside-body h-8x scrollable no-padding">
		  <div class="m">
			  <a href class="w-thumb-md pull-left m-r"><img src="/data/images/userimg/user_m.png" class="img-responsive"></a>
			  <div class="clear m-b-sm">
				  <div>{{bookDetail.member_name}} <code class="small">订单号 {{bookDetail.booking_number}}</code></div>
				  <span>{{bookDetail.member_mobile}} {{bookDetail.member_email}}</span>
				  <span class="text-muted text-xs">
                      <i class="far fa-clock"></i> {{bookDetail.check_in|limitTo:10}}~{{bookDetail.check_out|limitTo:10}}
				  </span>
			  </div>
		  </div>
        <div class="tab-container clear">
            <ul class="nav nav-tabs">
                <li ng-class="{active:activeRoomBookEditTab==1}" ng-click="activeRoomBookEditTab=1">
                    <a ng-bind-html="actionEdit"></a>
                </li>
                <!--<li ng-class="{active:activeRoomBookEditTab==2}" ng-click="activeRoomBookEditTab=2">
                    <a ng-bind-html="actionConsume"></a>
                </li>-->
				<li ng-class="{active:activeRoomBookEditTab==3}" ng-click="activeRoomBookEditTab=3">
                    <a ng-bind-html="actionAccounts"></a>
                </li>
                <li ng-class="{active:activeRoomBookEditTab==4}" ng-click="activeRoomBookEditTab=4">
                    <a ng-bind-html="actionEditLog"></a>
                </li>
            </ul>
            <div class="tab-content">
                <div ng-show="activeRoomBookEditTab==1">
                    <div class="btn-group m-b">
                        <button type="button" class="btn btn-rounded btn-default" ng-click="addGuestLiveIn('', '')"><i class="fa fa-users"></i> 添加住客</button>
                        <button type="button" class="btn btn-rounded btn-default" ng-click="addGuestLiveIn('AddBookRoom', '')"><i class="fas fa-bed"></i> 添加客房</button>
                        <button type="button" class="btn btn-rounded btn-default" ng-click="addGuestLiveIn('HaveLiveIn', '')"><i class="fas fa-procedures"></i> 客房入住</button>
                    </div>
                      <div class="table-responsive">
						<table class="table">
						  <thead>
							<tr>
							  <th class="col-xs-1">状态</th>
							  <th class="col-xs-1">房号</th>
							  <th class="col-xs-2">房型</th>
							  <th class="col-xs-2" translate="module.channel.market_name">客源市场</th>							  
							  <th class="col-xs-2">价格类型</th>
                              <th class="col-xs-1">价格</th>
							  <th class="col-xs-1">预抵</th>
							  <th class="col-xs-1">预离</th>
							  <th translate="common.hint.manager">管理</th>
							</tr>
						  </thead>
						  <tbody><!-- 单个订单 roomDetail -->
							<tr ng-repeat="(edit_i, rDetail) in roomDetail">
								<td colspan="9" class="no-padding panel">
								  <table class="table no-margin">
									  <tr>
										  <td class="col-xs-1">
											  <span ng-if="rDetail.booking_detail_status==1">入住</span>
											  <span ng-if="rDetail.booking_detail_status==0">预抵</span>
                                              <a class="fas fa-user-plus" ng-click="addGuestLiveIn('AddLiveIn', rDetail.item_id)"></a>
										  </td>
										  <td class="col-xs-1" toggle-class="fa fa-edit" class-target="a">{{rDetail.item_name==''?'未排房':rDetail.item_name}}
											<a class="fa pull-right" ng-click="showEditBookRoomAside(rDetail, 'Room')"></a></td>
										  <td class="col-xs-2" toggle-class="fa fa-edit" class-target="a">{{rDetail.item_category_name}}
											<a class="pull-right" ng-click="showEditBookRoomAside(rDetail, 'category')"></a></td>
										  <td class="col-xs-2" toggle-class="fa fa-edit" class-target="a" class="text-nowrap">{{rDetail.market_name}}
											<a class="pull-right" ng-click="showEditBookRoomAside(rDetail, 'market')"></a></td>
										  <td class="col-xs-2" toggle-class="fa fa-edit" class-target="a">{{rDetail.price_system_name}}
											<a class="pull-right" ng-click="showEditBookRoomAside(rDetail, 'system')"></a></td>
										  <td class="col-xs-1" show-bookroom-price="close" ng-Model="consumeList[rDetail.booking_number][rDetail.booking_detail_id]">{{consumeList[rDetail.booking_number][rDetail.booking_detail_id][0].consume_price}}
											<a class="pull-right"></a></td>
										  <td class="col-xs-1">{{rDetail.check_in | limitTo:10}}</td>
										  <td class="col-xs-1">{{rDetail.check_out | limitTo:10}}</td>
										  <td>
											  <!--<button class="btn btn-xs btn-default" ng-click="showEditBookRoomAside(rDetail, 'market')"><i class="glyphicon glyphicon-edit"></i></button>-->
											  <a class="btn btn-xs btn-default" ng-click="addGuestLiveIn('LiveInOne', rDetail)"><i class="fas fa-procedures"></i> 客房入住</a>
										  </td>
									  </tr>
                                      <tr>
                                          <td colspan="9" class="no-padding panel">
                                              <table class="table no-margin">
                                                  <tr ng-repeat="(number, LiveIn) in guestLiveInList[rDetail.booking_number][rDetail.booking_detail_id]">
                                                      <td class="col-xs-1"></td>
                                                      <td  class="col-xs-1" toggle-class="fa fa-edit" class-target="a"><i class="fa fa-user" ng-click="addGuestLiveIn('EditLiveIn', LiveIn)"></i><a class="pull-right" ng-click="addGuestLiveIn('EditLiveIn', LiveIn)"></a></td>
                                                      <td class="col-xs-1">{{LiveIn.member_name}}</td>
                                                      <td class="col-xs-1">{{LiveIn.member_sex==1?'男':'女'}}</td>
                                                      <td class="col-xs-1">{{LiveIn.member_mobile}}</td>
                                                      <td class="col-xs-1">
                                                          {{LiveIn.member_idcard_type=='id_card'?'身份证':''}}
                                                          {{LiveIn.member_idcard_type=='passport'?'护照':''}}
                                                          {{LiveIn.member_idcard_type=='officer_permit'?'军官证':''}}
                                                          {{LiveIn.member_idcard_type=='tw_permit'?'台胞证':''}}
                                                          {{LiveIn.member_idcard_type=='hk_permit'?'港澳台通行证':''}}
                                                          {{LiveIn.member_idcard_type=='other_permit'?'其它':''}}
                                                      </td>
                                                      <td>{{LiveIn.member_idcard_number}}</td>
                                                      <td colspan="2"></td>
                                                  </tr>
                                                </table>
                                            </td>
                                      </tr>
								  </table>
								</td>
							</tr>
						  </tbody>
						</table>
                    </div>
                </div>
				<div ng-show="activeRoomBookEditTab==2">
                      <div class="table-responsive">
						
                    </div>
                </div>
                <div ng-show="activeRoomBookEditTab==3">
                    <div class="panel-heading">
                        <script type="text/ng-template" id="/app/checkOutMenu.html">
                            <ul class="dropdown-menu">
                              <li><a href ng-click="bookingClose(bookDetail, 'refund')">结账退房</a></li>
                              <li><a href ng-click="bookingClose(bookDetail, 'hanging')">挂账退房</a></li>
                              <li><a href ng-click="bookingClose(bookDetail, 'close')">走结退房</a></li>
                              <li class="divider"></li>
							  <li><a href ng-click="bookingClose(bookDetail, 'cancel')">取消订单</a></li>
                            </ul>
                        </script>
                        <script type="text/ng-template" id="/app/accountsMenu.html">
                            <ul class="dropdown-menu">
                              <li><a href ng-click="bookingAccounts('', '')">收款</a></li>
                              <li><a href ng-click="bookingAccounts('', 'refund')">退款</a></li>
                              <li class="divider"></li>
                              <li><a href ng-click="bookingAccounts('', 'hanging')">挂账</a></li>
                            </ul>
                        </script>
                        <div class="btn-group m-b">
                            <button type="button" class="btn btn-rounded btn-default" ng-click="bookingConsume('', 'hanging')"><i class="fas fa-yen-sign"></i> 消费</button>
                            <div class="btn-group dropdown">
                              <button type="button" class="btn btn-rounded btn-default" bs-dropdown="dropdown" data-animation="am-fade-and-slide-top" data-template-url="/app/accountsMenu.html"><i class="fas fa-wallet"></i> 
                                入账 <span class="caret"></span>
                              </button>          
                            </div>
                            <div class="btn-group dropdown">
                              <button type="button" class="btn btn-rounded btn-default" bs-dropdown="dropdown" data-animation="am-fade-and-slide-top" data-template-url="/app/checkOutMenu.html"><i class="fas fa-cash-register"></i> 
                                结账 <span class="caret"></span>
                              </button>          
                            </div>
                        </div>
					</div>
                      <div class="table-responsive">
						<table class="table table-bordered table-striped bg-white">
						  <thead>
							<tr>
                              <th>房号</th>
							  <th>项目</th>
							  <th>数量</th>
							  <th>金额</th>
							  <th>营业日</th>
							  <th>管理</th>
							</tr>
						  </thead>
						  <tbody ng-repeat="(detail_id, consumes) in consumeDetail">
							<tr ng-repeat="(i, consume) in consumes">
							  <td class="text-nowrap">{{consume.item_name}}</td>
							  <td>{{consume.booking_type}}</td>
							  <td>{{consume.item_amount}}</td>
							  <td>{{consume.consume_price}}</td>
							  <td>{{consume.business_day}}</td>
							  <td>
							  <button class="btn btn-xs btn-default" ng-click="editConsume(consume)"><span translate="common.hint.edit" >编辑</span></button>
							  <button class="btn btn-xs btn-default" ng-click="editConsume(consume)"><span translate="common.hint.config" >配置</span></button>
							  </td>
							</tr>
						  </tbody>
						</table>
                    </div>
                    <div class="table-responsive">
						<table class="table table-bordered table-striped bg-white">
						  <thead>
							<tr>
                              <th>房号</th>
							  <th>项目</th>
							  <th>数量</th>
							  <th>金额</th>
							  <th>营业日</th>
							  <th>管理</th>
							</tr>
						  </thead>
						  <tbody>
							<tr ng-repeat="(i, account) in accountDetail">
							  <td class="text-nowrap">{{account.item_name}}</td>
							  <td>{{account.booking_type}}</td>
							  <td>{{account.item_amount}}</td>
							  <td>{{account.money}}</td>
							  <td>{{account.business_day}}</td>
							  <td>
							  <button class="btn btn-xs btn-default" ng-click="editConsume(account)"><span translate="common.hint.edit" >编辑</span></button>
							  <button class="btn btn-xs btn-default" ng-click="editConsume(account)"><span translate="common.hint.config" >配置</span></button>
							  </td>
							</tr>
						  </tbody>
						</table>
                    </div>
                </div>
                <div ng-show="activeRoomBookEditTab==4">
                      <div class="table-responsive">
						<table class="table bg-white">
						  <thead>
							<tr>
							  <th translate="module.channel.market_name">客源市场</th>
							  <th>房型</th>
							  <th>房号</th>
							  <th>客人名称</th>
							  <th translate="module.channel.phone">电话</th>
							  <th translate="module.channel.address">地址</th>
							  <th translate="common.hint.date">日期</th>
							</tr>
						  </thead>
						  <tbody>
							<tr ng-repeat="(i, rDetail) in roomDetail">
							  <td class="text-nowrap">{{rDetail.market_name}}</td>
							  <td><span>{{rDetail.market_name}}</span></td>
							  <td><a ng-click="config(Channel.id)">{{rDetail.channel_name}}</a></td>
							  <td>{{rDetail.channel_en_name}}</td>
							  <td>{{rDetail.phone}}</td>
							  <td>{{rDetail.address}}</td>
							  <td>{{rDetail.add_datetime}}</td>
							</tr>
						  </tbody>
						</table>
                    </div>
                </div>
                <div class="form-group"></div>
            </div>
        </div>
      </div>
      <div class="aside-footer panel-footer">
      	<input type="hidden" name="item_id" value="" ng-model="param.item_id" >
        <button type="button" class="btn btn-default" ng-click="$hide()">Close</button>
      </div>
      </form>
    </div>
  </div>
</div>
