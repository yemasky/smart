<span ng-include="'/resource/views/Common/nav.tpl.html'"></span>
<div class="p-md">
  <div class="box b-a bg-white m-b" ng-controller="RoomStatusController">
    <div class="col-md-10">
      <div class="panel-heading b-b b-light">{{arrayChannel.channel_name}}</div>
      <div class="panel-body">
        <p class="text-muted"><%$channel_config_name%> <!--增加属性--><a class="pull-right fa fa-plus-square" ng-click="addArrtibute('<%$channel_config_key%>', 0)"> </a></p>
        <div class="m-b-lg">
            <div class="m-b">
                <!--房间开始-->
              	<%if $channel_config_key=='room'%>
                <div class="buliding clear m-b" ng-repeat="(buliding_key, buliding) in itemList">
                	<div class="m-b"><i class="fa fa-building text-lg"> {{buliding_key}}楼栋</i></div>
                    <div class="floor clear" ng-repeat="(floor_key, floor) in buliding">
                    	<span class="badge bg-success pos-rlt m-r-xs"><b class="arrow right b-success pull-in"></b>{{floor_key}}楼层</span>
            			<div class="list-group no-radius">
                        <div class="list-group-item col-sm-3 m-xs" ng-repeat="(i, room) in floor">
                          <span class="pull-left w-thumb m-r b-b-2x"><img class="img-responsive" ng-src="<%$__RESOURCE%>images/room.png"></span>
                          <div class="clear">
                            <span class="font-bold block">房间名称/编号:{{room.item_name}} 
                            	<a><i class="glyphicon glyphicon-edit pull-right" ng-click="editItem(room.item_id)"></i></a>
                            </span> 
                            朝向:{{room.item_attr5_value}}  面积:{{room.item_attr4_value}} 类型:{{room.describe}}
                          </div>
                        </div>
                        </div> 
                    </div>
                </div>
            	<%/if%>
                <!--房间结束-->
                <!--房型开始-->
            	<%if $channel_config_key=='layout'%>
                <div class="list-group no-radius">
                    <div class="list-group-item col-sm-3 m-xs"  ng-repeat="(i, item) in itemList">
                      <span class="pull-left w-xs m-r b-b-2x"><img class="img-responsive" width="90" height="90" ng-src="{{item.image_src}}"></span>
                      <div class="clear">
                        <span class="font-bold block">{{item.item_name}}
                            <a><i class="glyphicon glyphicon-edit pull-right" ng-click="editItem(item.item_id)"></i></a>
                        </span> 
                        特色:{{item.describe}}
                      </div>
                    </div>
                </div>
             	<%/if%>
                <!--房型结束-->    
                <!--添加（房间|房型)按钮开始-->
                <div class="w-xl w-auto-xs">
                    <div class="box bg-white m-xs">
                      <div class="box-col w-auto-xs v-m">
                        <img ng-click="addArrtibute('<%$channel_config_key%>', 0)" ng-src="<%$__RESOURCE%>images/a10.jpg" width="120" height="120" class="b p-xs">
                      </div>
                      <div class="box-col p">
                        <a href="" class="pull-right fa fa-plus-square" ng-click="addArrtibute('<%$channel_config_key%>', 0)"> 添加<%$channel_config_name%></a>
                        <div></div>
                      </div>
                    </div>
                </div>
                <!--添加（房间|房型）按钮结束-->
            </div>
        </div>
      </div>
    </div>
    <!--右边comom添加属性开始-->
    <div class="col-md-2 b-l no-border-sm">
      <div class="panel-heading b-b b-light" translate="module.channel.arrtibute">属性</div>
      <div class="list-group no-border no-radius" ng-repeat="(i, Arrtibute) in configArrtibute" ng-if="i==0">
        <div class="list-group-item" ng-repeat="(father_id, childen) in Arrtibute">
            <div class="m-b-xs">
            <!--<a class="pull-right ti-settings" ng-click="config(i)"></a>-->
            <i class="fa fa-fw fa-circle text-info"></i>
            {{childen.attribute_name}}
            </div>
            <ul class="m-l nav b-b" ng-repeat="(j, sub) in configArrtibute[father_id]">
            	<li class="p-xs">{{sub.attribute_name}}</li>
                <li class="col-md-5 p-xs m-l-xs" ng-repeat="(l, subChilden) in configArrtibute[sub.attribute_id]">
                    <span class="fa fa-angle-right fa-fw text-muted"></span> {{subChilden.attribute_name}}
                </li>
            </ul>
        </div>
      </div>
    </div>
    <!--右边添加属性结束-->
  </div>
</div>
<script language="javascript" src="/resource/vendor/libs/moment.min.js"></script>
<script language="javascript" src="/resource/vendor/libs/daterangepicker.js"></script>
<script language="javascript">
app.controller('RoomStatusController', function($rootScope, $scope, $httpService, $location, $translate, $aside, $alert) {
	//获取数据
	var _channel = $scope.$stateParams.channel;
	var _view = $scope.$stateParams.view,common = '';
	var param = 'channel='+_channel+'&view='+_view;
	var loading = $alert({content: 'Loading... 90%', placement: 'top', type: 'info', templateUrl: '/loading.html', show: true});
	$httpService.post('/app.do?'+param, $scope, function(result){
		loading.hide();
		if(result.data.success == '0') {
			var message = $scope.getErrorByCode(result.data.code);
			$alert({title: 'Error', content: message, templateUrl: '/modal-warning.html', show: true});
		}
		common = result.data.common;
		$scope.setCommonSetting(common);
		
	});
	//
	var asideCustomerMarket = '';
	$scope.addCustomerMarket = function(_this) {
		$scope.param = {}; $scope.param["valid"] = "1";
		if(_this != 0) $scope.param = _this;
		$scope.action = '添加/编辑';
		asideCustomerMarket = $aside({scope : $scope, title: $scope.action_nav_name, placement:'top',animation:'am-fade-and-slide-top',backdrop:"static",container:'body', templateUrl: '/resource/views/Setting/CustomerMarketAddEdit.tpl.html'});
		asideCustomerMarket.$promise.then(function() {
			asideCustomerMarket.show();
			$(document).ready(function(){
				
			});
		})
		
	};
	$scope.saveData = function() {
		var param = this.param;
		if(param == null || param == '' || !angular.isDefined(param.market_father_id)) {
			$alert({title: 'Notice', content: '类型必须选择！', templateUrl: '/modal-warning.html', show: true});
			return;
		}
		loading = $alert({content: 'Saveing... 90%', placement: 'top', type: 'info', templateUrl: '/loading.html', show: true});
		$scope.param = param;
		$httpService.post('/app.do?channel='+common.saveAddEditUrl, $scope, function(result){
			loading.hide();
			$scope.dataList = result.data.item;
			asideCustomerMarket.hide();
			
		});
	}
	$httpService.deleteHeader('refresh');
});

</script>
